{
  "hash": "89b8746313ab4731ec04438362870177",
  "result": {
    "engine": "knitr",
    "markdown": "---\nfig-asp: 0.75\n---\n\n\n\n\n\n# Ordered Logit\n\n## Ordered Outcomes\n\nSuppose an ordered outcome $y_i \\in \\{1, 2, \\ldots, J\\}$, where $\\{1, 2, \\ldots, J\\}$ correspond to *qualitative labels* that have a natural ordering.\n\n*Example 1.* The ANES asks respondents to place themselves along a 7-point **ideology** scale with positions labeled \"extremely liberal,\" \"liberal,\" \"slightly liberal,\" \"moderate/middle of the road,\" \"slightly conservative,\" \"conservative,\" and \"extremely conservative.\" We typically let 1, 2, 3, 4, 5, 6, and 7. correspond to these seven ordered labels. \n\n*Example 2*. The **Political Terror Scale** (PTS) is a country-year measure of state repression. This measure assigns one of five qualitative labels summarizing the amount of state repression to each country-years based on reports from Amnesty International and the U.S. State Department.\n\n| Numeric Coding      | Qualitative Label |\n|------------|----------------|\n| 1  | Countries under a secure rule of law, people are not imprisoned for their views, and torture is rare or exceptional. Political murders are extremely rare. |\n| 2  | There is a limited amount of imprisonment for nonviolent political activity. However, few persons are affected, torture and beatings are exceptional. Political murder is rare. |\n| 3  | There is extensive political imprisonment, or a recent history of such imprisonment. Execution or other political murders and brutality may be common. Unlimited detention, with or without a trial, for political views is accepted. |\n| 4  | Civil and political rights violations have expanded to large numbers of the population. Murders, disappearances, and torture are a common part of life. In spite of its generality, on this level terror affects those who interest themselves in politics or ideas. |\n| 5  | Terror has expanded to the whole population. The leaders of these societies place no limits on the means or thoroughness with which they pursue personal or ideological goals. |\n\n## Ordered Logit\n\nLet linear predictor $\\eta_i$ be our usual linear predictor so that $\\eta_i = X_i^\\beta$, except *without an intercept $\\beta_0$.*\n\nNow define $J-1$ \"cutpoints\" $\\alpha_1 < \\alpha_2 < \\cdots < \\alpha_{J-1}$ that act as a separate intercept for each category.\n\nThe **ordered logit** defines the the *cumulative* probabilities as\n\n$$\n\\Pr(Y_i \\leq j) = \\text{logit}^{-1}(\\alpha_j - \\eta_i),\n\\qquad j = 1, \\ldots, J-1.\n$$\n\nThen probabilities for each category are\n\n$$\n\\begin{align}\n\\Pr(Y_i = 1) &= \\text{logit}^{-1}(\\alpha_1 - \\eta_i) \\\\\n\\Pr(Y_i = 2) &= \\text{logit}^{-1}(\\alpha_2 - \\eta_i) - \\text{logit}^{-1}(\\alpha_{1} - \\eta_i) \\\\\n\\Pr(Y_i = 3) &= \\text{logit}^{-1}(\\alpha_3 - \\eta_i) - \\text{logit}^{-1}(\\alpha_{3} - \\eta_i) \\\\\n             &\\vdots\\\\\n\\Pr(Y_i = j) &= \\overbrace{\\text{logit}^{-1}(\\alpha_j - \\eta_i)}^{\\Pr(Y_i \\leq j)} - \\overbrace{\\text{logit}^{-1}(\\alpha_{j-1} - \\eta_i)}^{^{\\Pr(Y_i \\leq j-1)}}, \\qquad j = 2, \\ldots, J-1 \\\\\n             &\\vdots\\\\\n\\Pr(Y_i = J) &= 1 - \\text{logit}^{-1}(\\alpha_{J-1} - \\eta_i).\n\\end{align}\n$$\n\nThe figure below shows this graphically for an outcome with four possible values.\n\n- I set the three cutpoints to $\\alpha = (-2.5,-1.3,1.3)$. \n- I set the linear predictor for an example observation to $\\eta_i = -1.5$. \n\nThe figure shows how $\\alpha$ and $\\eta_i$ are translated into $\\Pr(y_i = j)$.\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-1-1.png){width=1152}\n:::\n:::\n\n\n\n\n\n## Example: Party ID by age and race in 2014\n\nAs an example, we can model party ID as a function of income.\n\n### `polr()`\n\nFirst, load a data set I've created with variables party id (`pid`) and income. \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load data\nanes <- read_csv(\"data/red-state-pid.csv\") |>\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 4,596\nColumns: 5\n$ state_name             <chr> \"Oklahoma\", \"Idaho\", \"Virginia\", \"California\", …\n$ state_median_income    <dbl> 66.1, 81.2, 92.1, 100.1, 97.1, 79.7, 77.5, 100.…\n$ rs_state_median_income <dbl> -0.595342224, -0.010181986, 0.412218451, 0.7222…\n$ income                 <dbl> 1.5, 1.5, 1.5, -0.5, -0.5, -0.5, -0.5, -2.5, 0.…\n$ pid                    <chr> \"7. Strong Republican\", \"4. Independent\", \"1. S…\n```\n\n\n:::\n:::\n\n\n\n\n\nNotice that the ordinal party ID lables have a numerial prefix as part of the character string. This is helpful to (1) quickly remind us of the order and (2) ensure that the alphabetic order and ordinal rankings of their values are the same. \n\nBecause the dataset is in `.csv` format, `pid` is loaded as a character string, but we can easily convert it to an ordered factor.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load data\nanes <- read_csv(\"https://pos5747.github.io/data/red-state-pid.csv\") |>\n  mutate(pid = factor(pid, ordered = TRUE)) |>\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 4,596\nColumns: 5\n$ state_name             <chr> \"Oklahoma\", \"Idaho\", \"Virginia\", \"California\", …\n$ state_median_income    <dbl> 66.1, 81.2, 92.1, 100.1, 97.1, 79.7, 77.5, 100.…\n$ rs_state_median_income <dbl> -0.595342224, -0.010181986, 0.412218451, 0.7222…\n$ income                 <dbl> 1.5, 1.5, 1.5, -0.5, -0.5, -0.5, -0.5, -2.5, 0.…\n$ pid                    <ord> 7. Strong Republican, 4. Independent, 1. Strong…\n```\n\n\n:::\n\n```{.r .cell-code}\n# examine levels of ordinal variable\nlevels(anes$pid)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"1. Strong Democrat\"                \"2. Not very strong Democrat\"      \n[3] \"3. Independent (leans Democrat)\"   \"4. Independent\"                   \n[5] \"5. Independent (leans Republican)\" \"6. Not very strong Republican\"    \n[7] \"7. Strong Republican\"             \n```\n\n\n:::\n:::\n\n\n\n\nBecause of the numbers I included in the prefix, the default *alphabetical* ordering is *exactly the ordering we want.*\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# fit ordered logit model\nlibrary(MASS)  # be wary of conflicts with filter() and select()\nfit <- polr(pid ~ income, data = anes, Hess = TRUE)\n\n# summarize fit\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\npolr(formula = pid ~ income, data = anes, Hess = TRUE)\n\nCoefficients:\n          Value Std. Error t value\nincome -0.02192    0.01843  -1.189\n\nIntercepts:\n                                                                Value   \n1. Strong Democrat|2. Not very strong Democrat                   -1.0666\n2. Not very strong Democrat|3. Independent (leans Democrat)      -0.5277\n3. Independent (leans Democrat)|4. Independent                    0.0123\n4. Independent|5. Independent (leans Republican)                  0.2257\n5. Independent (leans Republican)|6. Not very strong Republican   0.7555\n6. Not very strong Republican|7. Strong Republican                1.2820\n                                                                Std. Error\n1. Strong Democrat|2. Not very strong Democrat                    0.0344  \n2. Not very strong Democrat|3. Independent (leans Democrat)       0.0313  \n3. Independent (leans Democrat)|4. Independent                    0.0302  \n4. Independent|5. Independent (leans Republican)                  0.0304  \n5. Independent (leans Republican)|6. Not very strong Republican   0.0324  \n6. Not very strong Republican|7. Strong Republican                0.0365  \n                                                                t value \n1. Strong Democrat|2. Not very strong Democrat                  -30.9733\n2. Not very strong Democrat|3. Independent (leans Democrat)     -16.8853\n3. Independent (leans Democrat)|4. Independent                    0.4074\n4. Independent|5. Independent (leans Republican)                  7.4259\n5. Independent (leans Republican)|6. Not very strong Republican  23.3255\n6. Not very strong Republican|7. Strong Republican               35.1414\n\nResidual Deviance: 16952.51 \nAIC: 16966.51 \n```\n\n\n:::\n:::\n\n\n\n\n\n### Probabilities with \\{marginaleffects\\}\n\nTo interpret the coefficients, we can compute the probability of falling into each category as age varies from 18 to 89 years.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# use {marginaleffects}\nlibrary(marginaleffects)\np <- predictions(fit, \n            newdata = datagrid(income = unique)) |>\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 42\nColumns: 12\n$ rowid     <dbl> 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, …\n$ group     <fct> 1. Strong Democrat, 1. Strong Democrat, 1. Strong Democrat, …\n$ estimate  <dbl> 0.24575788, 0.24984362, 0.25397441, 0.25814999, 0.26237009, …\n$ std.error <dbl> 0.011645748, 0.009052791, 0.007085123, 0.006474830, 0.007661…\n$ statistic <dbl> 21.10280, 27.59852, 35.84615, 39.86977, 34.24347, 26.38353, …\n$ p.value   <dbl> 7.496604e-99, 1.159208e-167, 2.111349e-281, 0.000000e+00, 5.…\n$ s.value   <dbl> 325.9646, 554.5489, 932.3836, Inf, 851.2881, 507.1728, 346.8…\n$ conf.low  <dbl> 0.22293263, 0.23210047, 0.24008782, 0.24545956, 0.24735304, …\n$ conf.high <dbl> 0.26858312, 0.26758676, 0.26786100, 0.27084043, 0.27738714, …\n$ pid       <ord> 1. Strong Democrat, 1. Strong Democrat, 1. Strong Democrat, …\n$ income    <dbl> -2.5, -1.5, -0.5, 0.5, 1.5, 2.5, -2.5, -1.5, -0.5, 0.5, 1.5,…\n$ df        <dbl> Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, …\n```\n\n\n:::\n\n```{.r .cell-code}\nggplot(p, aes(x = income, y = estimate, color = group)) + \n  geom_point() + \n  geom_line()\n```\n\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### Computing cumulative probabilities\n\nHowever, the probabilities above are somewhat awkward to interpret. As the middle categories shrink, it isn't immediately clear what categories are growing as a result. Instead, we can compute an easier-to-interpret *cumulative* probability using `cumsum()` within `arrange()`ed groups. \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncumulative_p <- p %>%\n  arrange(income, group) %>%\n  group_by(income) %>%\n  mutate(cumulative_prob = cumsum(estimate),\n         j = as.integer(group),\n         cdf_label = paste0(\"Pr(Y ≤ \", group, \")\"),\n         cdf_label = reorder(cdf_label, j)) %>%\n  ungroup()\nggplot(cumulative_p, aes(x = income, y = cumulative_prob, color = cdf_label)) + \n  geom_line() \n```\n\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n\nAlternatively, w can use `position = \"stack\"` with `geom_line()` or `geom_area()` to trick `ggplot()` into plotting the cumulative probabilities for us if we don't want to compute them manually first.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(p, aes(x = income, y = estimate, color = group)) +\n  geom_line(position = \"stack\")\n```\n\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(p, aes(x = income, y = estimate, fill = group)) +\n  geom_area(position = \"stack\")\n```\n\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\n\n\n\n### Example: The varying relationship across years\n\nWe can use a hierarchical variant to model the differences across states. Consistent with Gelman et al.'s \"red state, blue state\" argument, the changes across income might vary across rich and poor states. \n\nWith that in mind, we allow varying intercepts and slopes across states and model those using state median income.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load packages\nlibrary(brms)\n\n# fit same model, but coefs vary across years\nfit <- brm(pid ~ income*rs_state_median_income + (1 + income | state_name), \n           data = anes, \n           family = cumulative(),\n           cores = 4, \n           chains = 4, \n           backend = \"rstan\")\n```\n:::\n\n\n\n\n\nNow we can plot the cumulative probabilities for each of the states and see that the effect of income does indeed vary across the states.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# make grid \ngrid <- anes %>%\n  dplyr::select(state_name, state_median_income, rs_state_median_income) %>%\n  distinct() %>%\n  mutate(income = NA) |>\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 51\nColumns: 4\n$ state_name             <chr> \"Oklahoma\", \"Idaho\", \"Virginia\", \"California\", …\n$ state_median_income    <dbl> 66.1, 81.2, 92.1, 100.1, 97.1, 79.7, 77.5, 102.…\n$ rs_state_median_income <dbl> -0.595342224, -0.010181986, 0.412218451, 0.7222…\n$ income                 <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n```\n\n\n:::\n\n```{.r .cell-code}\n# make predictions\np <- predictions(fit, \n                 variables = list(income = unique),\n                 newdata = grid) |>\n  mutate(state_name = reorder(state_name, rs_state_median_income)) |>\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 2,142\nColumns: 10\n$ rowid                  <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, …\n$ rowidcf                <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, …\n$ group                  <fct> 1. Strong Democrat, 1. Strong Democrat, 1. Stro…\n$ estimate               <dbl> 0.2455175, 0.2513170, 0.2454534, 0.2646395, 0.2…\n$ conf.low               <dbl> 0.1562062, 0.1742986, 0.1742482, 0.2087313, 0.1…\n$ conf.high              <dbl> 0.3409455, 0.3523408, 0.3200198, 0.3278561, 0.3…\n$ rs_state_median_income <dbl> -0.595342224, -0.010181986, 0.412218451, 0.7222…\n$ state_name             <fct> Oklahoma, Idaho, Virginia, California, Colorado…\n$ income                 <dbl> -2.5, -2.5, -2.5, -2.5, -2.5, -2.5, -2.5, -2.5,…\n$ df                     <dbl> Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, In…\n```\n\n\n:::\n\n```{.r .cell-code}\n# make plot\nggplot(p, aes(x = income, y = estimate, fill = group)) +\n  geom_area(position = \"stack\") +\n  facet_wrap(vars(state_name), ncol = 4)  +\n  scale_fill_brewer(palette = \"RdBu\", direction = -1)\n```\n\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}