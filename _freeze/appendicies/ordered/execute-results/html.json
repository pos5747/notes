{
  "hash": "358f5ef2de5a0eabf09b646e5b194889",
  "result": {
    "engine": "knitr",
    "markdown": "# Ordered Logit\n\n## Ordered Outcomes\n\nSuppose an ordered outcome $y_i \\in \\{1, 2, \\ldots, J\\}$, where $\\{1, 2, \\ldots, J\\}$ correspond to *qualitative labels* that have a natural ordering.\n\n*Example 1.* The ANES asks respondents to place themselves along a 7-point **ideology** scale with positions labeled \"extremely liberal,\" \"liberal,\" \"slightly liberal,\" \"moderate/middle of the road,\" \"slightly conservative,\" \"conservative,\" and \"extremely conservative.\" We typically let 1, 2, 3, 4, 5, 6, and 7. correspond to these seven ordered labels. \n\n*Example 2*. The **Political Terror Scale** (PTS) is a country-year measure of state repression. This measure assigns one of five qualitative labels summarizing the amount of state repression to each country-years based on reports from Amnesty International and the U.S. State Department.\n\n| Numeric Coding      | Qualitative Label |\n|------------|----------------|\n| 1  | Countries under a secure rule of law, people are not imprisoned for their views, and torture is rare or exceptional. Political murders are extremely rare. |\n| 2  | There is a limited amount of imprisonment for nonviolent political activity. However, few persons are affected, torture and beatings are exceptional. Political murder is rare. |\n| 3  | There is extensive political imprisonment, or a recent history of such imprisonment. Execution or other political murders and brutality may be common. Unlimited detention, with or without a trial, for political views is accepted. |\n| 4  | Civil and political rights violations have expanded to large numbers of the population. Murders, disappearances, and torture are a common part of life. In spite of its generality, on this level terror affects those who interest themselves in politics or ideas. |\n| 5  | Terror has expanded to the whole population. The leaders of these societies place no limits on the means or thoroughness with which they pursue personal or ideological goals. |\n\n## Ordered Logit\n\nLet linear predictor $\\eta_i$ be our usual linear predictor so that $\\eta_i = X_i^\\beta$, except *without an intercept $\\beta_0$.*\n\nNow define $J-1$ \"cutpoints\" $\\alpha_1 < \\alpha_2 < \\cdots < \\alpha_{J-1}$ that act as a separate intercept for each category.\n\nThe **ordered logit** defines the the *cumulative* probabilities as\n\n$$\n\\Pr(Y_i \\leq j) = \\text{logit}^{-1}(\\alpha_j - \\eta_i),\n\\qquad j = 1, \\ldots, J-1.\n$$\n\nThen probabilities for each category are\n\n$$\n\\begin{align}\n\\Pr(Y_i = 1) &= \\text{logit}^{-1}(\\alpha_1 - \\eta_i) \\\\\n\\Pr(Y_i = 2) &= \\text{logit}^{-1}(\\alpha_2 - \\eta_i) - \\text{logit}^{-1}(\\alpha_{1} - \\eta_i) \\\\\n\\Pr(Y_i = 3) &= \\text{logit}^{-1}(\\alpha_3 - \\eta_i) - \\text{logit}^{-1}(\\alpha_{3} - \\eta_i) \\\\\n             &\\vdots\\\\\n\\Pr(Y_i = j) &= \\overbrace{\\text{logit}^{-1}(\\alpha_j - \\eta_i)}^{\\Pr(Y_i \\leq j)} - \\overbrace{\\text{logit}^{-1}(\\alpha_{j-1} - \\eta_i)}^{^{\\Pr(Y_i \\leq j-1)}}, \\qquad j = 2, \\ldots, J-1 \\\\\n             &\\vdots\\\\\n\\Pr(Y_i = J) &= 1 - \\text{logit}^{-1}(\\alpha_{J-1} - \\eta_i).\n\\end{align}\n$$\n\nThe figure below shows this graphically for an outcome with four possible values.\n\n- I set the three cutpoints to $\\alpha = (-2.5,-1.3,1.3)$. \n- I set the linear predictor for an example observation to $\\eta_i = -1.5$. \n\nThe figure shows how $\\alpha$ and $\\eta_i$ are translated into $\\Pr(y_i = j)$.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-1-1.png){width=1152}\n:::\n:::\n\n\n\n\n## Example\n\nAs an example, we can model party ID as a function of age and race.\n\n### `polr()`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load data\ndf <- forcats::gss_cat |>\n  mutate(race = fct_drop(race)) |>\n  mutate(partyid = case_when(partyid == \"No answer\" ~ NA,\n                             partyid == \"Don't know\" ~ NA,\n                             partyid == \"Other party\" ~ NA, \n                             TRUE ~ partyid),\n         partyid = fct_drop(partyid)) |>\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 21,483\nColumns: 9\n$ year    <int> 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 20…\n$ marital <fct> Never married, Divorced, Widowed, Never married, Divorced, Mar…\n$ age     <int> 26, 48, 67, 39, 25, 25, 36, 44, 44, 47, 53, 52, 52, 51, 52, 40…\n$ race    <fct> White, White, White, White, White, White, White, White, White,…\n$ rincome <fct> $8000 to 9999, $8000 to 9999, Not applicable, Not applicable, …\n$ partyid <fct> \"Ind,near rep\", \"Not str republican\", \"Independent\", \"Ind,near…\n$ relig   <fct> Protestant, Protestant, Protestant, Orthodox-christian, None, …\n$ denom   <fct> \"Southern baptist\", \"Baptist-dk which\", \"No denomination\", \"No…\n$ tvhours <int> 12, NA, 2, 4, 1, NA, 3, NA, 0, 3, 2, NA, 1, NA, 1, 7, NA, 3, 3…\n```\n\n\n:::\n\n```{.r .cell-code}\n# look at outcome\nlevels(df$partyid)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Strong republican\"  \"Not str republican\" \"Ind,near rep\"      \n[4] \"Independent\"        \"Ind,near dem\"       \"Not str democrat\"  \n[7] \"Strong democrat\"   \n```\n\n\n:::\n\n```{.r .cell-code}\n# fit ordered logit model\nfit <- MASS::polr(partyid ~ age*race, data = df, Hess = TRUE)\n\n# summarize fit\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\nMASS::polr(formula = partyid ~ age * race, data = df, Hess = TRUE)\n\nCoefficients:\n                  Value Std. Error t value\nage            0.006391   0.002700   2.367\nraceBlack      0.388149   0.145785   2.662\nraceWhite     -0.372259   0.118424  -3.143\nage:raceBlack  0.016566   0.003410   4.858\nage:raceWhite -0.004478   0.002819  -1.588\n\nIntercepts:\n                                     Value    Std. Error t value \nStrong republican|Not str republican  -2.1803   0.1129   -19.3158\nNot str republican|Ind,near rep       -1.1352   0.1116   -10.1686\nInd,near rep|Independent              -0.7013   0.1114    -6.2974\nIndependent|Ind,near dem               0.1631   0.1112     1.4667\nInd,near dem|Not str democrat          0.7035   0.1114     6.3169\nNot str democrat|Strong democrat       1.7520   0.1123    15.5953\n\nResidual Deviance: 77509.31 \nAIC: 77531.31 \n(612 observations deleted due to missingness)\n```\n\n\n:::\n:::\n\n\n\n\n### Probabilities with \\{marginaleffects\\}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# use {marginaleffects}\nlibrary(marginaleffects)\np <- predictions(fit, \n            variables = list(age = 25:75), \n            newdata = datagrid(race = unique)) |>\n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,071\nColumns: 14\n$ rowid     <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…\n$ rowidcf   <int> 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, …\n$ group     <fct> \"Strong republican\", \"Strong republican\", \"Strong republican…\n$ estimate  <dbl> 0.08785574, 0.04139204, 0.13518215, 0.08734494, 0.04049068, …\n$ std.error <dbl> 0.004540840, 0.002141267, 0.003422155, 0.004380073, 0.002043…\n$ statistic <dbl> 19.34791, 19.33063, 39.50206, 19.94143, 19.81409, 40.18805, …\n$ p.value   <dbl> 2.122961e-83, 2.967508e-83, 0.000000e+00, 1.778963e-88, 2.25…\n$ s.value   <dbl> 274.6340, 274.1508, Inf, 291.4986, 287.8376, Inf, 309.0754, …\n$ conf.low  <dbl> 0.07895585, 0.03719523, 0.12847485, 0.07876015, 0.03648544, …\n$ conf.high <dbl> 0.09675562, 0.04558884, 0.14188945, 0.09592972, 0.04449592, …\n$ partyid   <fct> \"Independent\", \"Independent\", \"Independent\", \"Independent\", …\n$ race      <fct> Other, Black, White, Other, Black, White, Other, Black, Whit…\n$ age       <int> 25, 25, 25, 26, 26, 26, 27, 27, 27, 28, 28, 28, 29, 29, 29, …\n$ df        <dbl> Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, …\n```\n\n\n:::\n\n```{.r .cell-code}\nggplot(p, aes(x = age, y = estimate, color = group)) + \n  geom_line() + \n  facet_wrap(vars(race))\n```\n\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n### Computing cumulative probabilities\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncumulative_p <- p %>%\n  arrange(race, age, group) %>%\n  group_by(race, age) %>%\n  mutate(cumulative_prob = cumsum(estimate),\n         j = as.integer(group),\n         cdf_label = paste0(\"Pr(Y ≤ \", group, \")\"),\n         cdf_label = reorder(cdf_label, -j)) %>%\n  ungroup()\nggplot(cumulative_p, aes(x = age, y = cumulative_prob, color = cdf_label)) + \n  geom_line() + \n  facet_wrap(vars(race)) \n```\n\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\nWe can use `position = \"stack\"` to trick `ggplot()` into plotting the cumulative probabilities for us if we don't want to compute them manually first.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(p, aes(x = age, y = estimate, color = group)) +\n  geom_line(position = \"stack\") +\n  facet_wrap(vars(race))\n```\n\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(p, aes(x = age, y = estimate, fill = group)) +\n  geom_area(position = \"stack\") +\n  facet_wrap(vars(race)) \n```\n\n::: {.cell-output-display}\n![](ordered_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}